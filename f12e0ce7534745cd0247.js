/*! For license information please see f12e0ce7534745cd0247.js.LICENSE.txt */
function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _regeneratorValues(e){if(null!=e){var n=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}throw new TypeError(_typeof(e)+" is not iterable")}function _slicedToArray(e,n){return _arrayWithHoles(e)||_iterableToArrayLimit(e,n)||_unsupportedIterableToArray(e,n)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,n){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var t,a,o,c,s=[],i=!0,l=!1;try{if(o=(r=r.call(e)).next,0===n){if(Object(r)!==r)return;i=!1}else for(;!(i=(t=o.call(r)).done)&&(s.push(t.value),s.length!==n);i=!0);}catch(e){l=!0,a=e}finally{try{if(!i&&null!=r.return&&(c=r.return(),Object(c)!==c))return}finally{if(l)throw a}}return s}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function ownKeys(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,t)}return r}function _objectSpread(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?ownKeys(Object(r),!0).forEach(function(n){_defineProperty(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function _defineProperty(e,n,r){return(n=_toPropertyKey(n))in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function _toPropertyKey(e){var n=_toPrimitive(e,"string");return"symbol"==_typeof(n)?n:n+""}function _toPrimitive(e,n){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var t=r.call(e,n||"default");if("object"!=_typeof(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}function _createForOfIteratorHelper(e,n){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||n&&e&&"number"==typeof e.length){r&&(e=r);var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){s=!0,o=e},f:function(){try{c||null==r.return||r.return()}finally{if(s)throw o}}}}function _unsupportedIterableToArray(e,n){if(e){if("string"==typeof e)return _arrayLikeToArray(e,n);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,n):void 0}}function _arrayLikeToArray(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=Array(n);r<n;r++)t[r]=e[r];return t}function _regenerator(){var e,n,r="function"==typeof Symbol?Symbol:{},t=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function o(r,t,a,o){var i=t&&t.prototype instanceof s?t:s,l=Object.create(i.prototype);return _regeneratorDefine2(l,"_invoke",function(r,t,a){var o,s,i,l=0,u=a||[],f=!1,g={p:0,n:0,v:e,a:y,f:y.bind(e,4),d:function(n,r){return o=n,s=0,i=e,g.n=r,c}};function y(r,t){for(s=r,i=t,n=0;!f&&l&&!a&&n<u.length;n++){var a,o=u[n],y=g.p,p=o[2];r>3?(a=p===t)&&(i=o[(s=o[4])?5:(s=3,3)],o[4]=o[5]=e):o[0]<=y&&((a=r<2&&y<o[1])?(s=0,g.v=t,g.n=o[1]):y<p&&(a=r<3||o[0]>t||t>p)&&(o[4]=r,o[5]=t,g.n=p,s=0))}if(a||r>1)return c;throw f=!0,t}return function(a,u,p){if(l>1)throw TypeError("Generator is already running");for(f&&1===u&&y(u,p),s=u,i=p;(n=s<2?e:i)||!f;){o||(s?s<3?(s>1&&(g.n=-1),y(s,i)):g.n=i:g.v=i);try{if(l=2,o){if(s||(a="next"),n=o[a]){if(!(n=n.call(o,i)))throw TypeError("iterator result is not an object");if(!n.done)return n;i=n.value,s<2&&(s=0)}else 1===s&&(n=o.return)&&n.call(o),s<2&&(i=TypeError("The iterator does not provide a '"+a+"' method"),s=1);o=e}else if((n=(f=g.n<0)?i:r.call(t,g))!==c)break}catch(n){o=e,s=1,i=n}finally{l=1}}return{value:n,done:f}}}(r,a,o),!0),l}var c={};function s(){}function i(){}function l(){}n=Object.getPrototypeOf;var u=[][t]?n(n([][t]())):(_regeneratorDefine2(n={},t,function(){return this}),n),f=l.prototype=s.prototype=Object.create(u);function g(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,_regeneratorDefine2(e,a,"GeneratorFunction")),e.prototype=Object.create(f),e}return i.prototype=l,_regeneratorDefine2(f,"constructor",l),_regeneratorDefine2(l,"constructor",i),i.displayName="GeneratorFunction",_regeneratorDefine2(l,a,"GeneratorFunction"),_regeneratorDefine2(f),_regeneratorDefine2(f,a,"Generator"),_regeneratorDefine2(f,t,function(){return this}),_regeneratorDefine2(f,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:o,m:g}})()}function _regeneratorDefine2(e,n,r,t){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}_regeneratorDefine2=function(e,n,r,t){function o(n,r){_regeneratorDefine2(e,n,function(e){return this._invoke(n,r,e)})}n?a?a(e,n,{value:r,enumerable:!t,configurable:!t,writable:!t}):e[n]=r:(o("next",0),o("throw",1),o("return",2))},_regeneratorDefine2(e,n,r,t)}function asyncGeneratorStep(e,n,r,t,a,o,c){try{var s=e[o](c),i=s.value}catch(e){return void r(e)}s.done?n(i):Promise.resolve(i).then(t,a)}function _asyncToGenerator(e){return function(){var n=this,r=arguments;return new Promise(function(t,a){var o=e.apply(n,r);function c(e){asyncGeneratorStep(o,t,a,c,s,"next",e)}function s(e){asyncGeneratorStep(o,t,a,c,s,"throw",e)}c(void 0)})}}var OPENAI_API_URL="https://api.openai.com/v1/chat/completions",MODEL="gpt-4o-mini",MAX_RETRIES=3,RETRY_DELAY=2e3,HEADER_ROW=1,BATCH_SIZE=80,glossaryCache=null,plGlossaryCache=null,availableLangs=[],plAvailableLangs=[],langToSheetMap={},plLangToSheetMap={};function customAlert(e){return new Promise(function(n){var r=document.getElementById("alertModal"),t=document.getElementById("alertMessage"),a=document.getElementById("alertOk");t.textContent=e,r.classList.remove("hidden"),a.onclick=function(){return r.classList.add("hidden"),a.onclick=null,void n()}})}function customConfirm(e){return new Promise(function(n){var r=document.getElementById("confirmModal"),t=document.getElementById("confirmMessage"),a=document.getElementById("confirmYes"),o=document.getElementById("confirmNo");t.textContent=e,r.classList.remove("hidden");var c=function(e){r.classList.add("hidden"),a.onclick=null,o.onclick=null,n(e)};a.onclick=function(){return c(!0)},o.onclick=function(){return c(!1)}})}function getApiKey(){try{if("undefined"!=typeof Office&&Office.context&&Office.context.roamingSettings)return Office.context.roamingSettings.get("openai_api_key")||""}catch(e){console.log("roamingSettings not available, using localStorage")}try{return localStorage.getItem("openai_api_key")||""}catch(e){return console.error("Storage not available:",e),""}}function saveApiKey(){return _saveApiKey.apply(this,arguments)}function _saveApiKey(){return(_saveApiKey=_asyncToGenerator(_regenerator().m(function e(){var n,r,t;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=document.getElementById("apiKeyInput"),r=n.value.trim()){e.n=2;break}return e.n=1,customAlert("Wklej sw√≥j klucz API!");case 1:return e.a(2);case 2:if(r.startsWith("sk-")){e.n=4;break}return e.n=3,customAlert("Klucz API powinien zaczynaƒá siƒô od 'sk-'");case 3:return e.a(2);case 4:e.p=4,"undefined"!=typeof Office&&Office.context&&Office.context.roamingSettings?(Office.context.roamingSettings.set("openai_api_key",r),Office.context.roamingSettings.saveAsync(function(e){e.status===Office.AsyncResultStatus.Succeeded?log("‚úÖ Klucz API zapisany!"):log("‚ö†Ô∏è B≈ÇƒÖd zapisu: "+e.error.message)})):(localStorage.setItem("openai_api_key",r),log("‚úÖ Klucz API zapisany (localStorage)!")),n.value="",n.type="password",updateApiKeyStatus(),e.n=7;break;case 5:return e.p=5,t=e.v,e.n=6,customAlert("B≈ÇƒÖd zapisu klucza: "+t.message);case 6:console.error(t);case 7:return e.a(2)}},e,null,[[4,5]])}))).apply(this,arguments)}function clearApiKey(){return _clearApiKey.apply(this,arguments)}function _clearApiKey(){return(_clearApiKey=_asyncToGenerator(_regenerator().m(function e(){var n;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.n=1,customConfirm("Czy na pewno chcesz usunƒÖƒá zapisany klucz API?");case 1:if(!e.v){e.n=5;break}e.p=2,"undefined"!=typeof Office&&Office.context&&Office.context.roamingSettings&&(Office.context.roamingSettings.remove("openai_api_key"),Office.context.roamingSettings.saveAsync()),localStorage.removeItem("openai_api_key"),document.getElementById("apiKeyInput").value="",updateApiKeyStatus(),log("üóëÔ∏è Klucz API usuniƒôty"),e.n=5;break;case 3:return e.p=3,n=e.v,e.n=4,customAlert("B≈ÇƒÖd usuwania klucza: "+n.message);case 4:console.error(n);case 5:return e.a(2)}},e,null,[[2,3]])}))).apply(this,arguments)}function updateApiKeyStatus(){var e=document.getElementById("apiKeyStatus"),n=getApiKey();if(n){var r=n.substring(0,10)+"..."+n.substring(n.length-4);e.innerHTML="‚úÖ Klucz zapisany: <code>".concat(r,'</code> | <a href="https://platform.openai.com/api-keys" target="_blank">Zmie≈Ñ klucz</a>'),e.style.color="#10a37f"}else e.innerHTML='‚ö†Ô∏è Brak klucza API! <a href="https://platform.openai.com/api-keys" target="_blank">Uzyskaj klucz tutaj</a>',e.style.color="#ff6b6b"}function log(e){var n=document.getElementById("log");n&&(n.textContent+=e+"\n",n.scrollTop=n.scrollHeight)}function setProgress(e){var n=document.getElementById("progress"),r=document.getElementById("progressBar");n&&r&&(null!=e?(n.classList.remove("hidden"),r.style.width="".concat(e,"%")):n.classList.add("hidden"))}function fillLangDropdown(){var e=document.getElementById("gLangSelect"),n=document.getElementById("sourceLangSelect").value||"EN";e.innerHTML="";var r="PL"===n?plAvailableLangs:availableLangs,t="PL"===n?"PL-XX":"EN-XX";if(!r.length){var a=document.createElement("option");return a.value="",a.textContent="(brak arkuszy ".concat(t,")"),void e.appendChild(a)}var o=document.createElement("option");o.value="",o.textContent="Wszystkie jƒôzyki",e.appendChild(o);var c,s=_createForOfIteratorHelper(r);try{for(s.s();!(c=s.n()).done;){var i=c.value,l=document.createElement("option");l.value=i,l.textContent=i,e.appendChild(l)}}catch(e){s.e(e)}finally{s.f()}}function updateGlossaryPlaceholders(){var e=document.getElementById("sourceLangSelect").value||"EN";document.getElementById("gEn").placeholder="PL"===e?"Fraza PL (np. grza≈Çka)":"Fraza EN (np. heating element)"}function runTranslate(){return _runTranslate.apply(this,arguments)}function _runTranslate(){return _runTranslate=_asyncToGenerator(_regenerator().m(function e(){var n,r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(getApiKey()){e.n=2;break}return e.n=1,customAlert("‚ö†Ô∏è Najpierw zapisz sw√≥j klucz OpenAI API w sekcji Konfiguracja!");case 1:case 4:return e.a(2);case 2:if(n=document.getElementById("skipFilled").checked,r=document.getElementById("sourceLangSelect").value||"EN",glossaryCache){e.n=3;break}return e.n=3,refreshGlossaryAll();case 3:return log("Czytam zaznaczenie... (≈∫r√≥d≈Ço: ".concat(r,")")),e.n=4,Excel.run(function(){var e=_asyncToGenerator(_regenerator().m(function e(t){var a,o,c,s,i,l,u,f,g,y,p,d,m,h,v,k,b,w,_,E,z,A,S,I,O,T,L,G,C,B,P,j,x,R,D,N,K,H,U,M,F;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return a=t.workbook.worksheets.getActiveWorksheet(),(o=t.workbook.getSelectedRange()).load(["rowCount","columnCount","rowIndex","columnIndex"]),e.n=1,t.sync();case 1:return(c=a.getUsedRange()).load("columnCount"),e.n=2,t.sync();case 2:return(s=a.getRangeByIndexes(HEADER_ROW-1,0,1,c.columnCount)).load("values"),e.n=3,t.sync();case 3:if(i=s.values[0].map(function(e){return normalizeHeader(e)}),!((l=i.indexOf(r))<0)){e.n=4;break}return log("B≈ÅƒÑD: brak kolumny ".concat(r," w wierszu nag≈Ç√≥wk√≥w (1).")),e.a(2);case 4:for(u="PL"===r?plGlossaryCache:glossaryCache,f=[],g=0;g<o.rowCount;g++)for(y=0;y<o.columnCount;y++)p=o.rowIndex+g,d=o.columnIndex+y,m=i[d],h=a.getCell(p,l),v=a.getCell(p,d),h.load("values"),v.load("values"),f.push({absRow:p,absCol:d,tgtLang:m,srcCell:h,tgtCell:v});return e.n=5,t.sync();case 5:k=new Map,b=0,w=f;case 6:if(!(b<w.length)){e.n=11;break}if(_=w[b],E=(_.srcCell.values[0][0]||"").toString().trim(),z=(_.tgtCell.values[0][0]||"").toString().trim(),E){e.n=7;break}return e.a(3,10);case 7:if(!n||!z){e.n=8;break}return e.a(3,10);case 8:if(_.tgtLang!==r){e.n=9;break}return e.a(3,10);case 9:k.has(_.tgtLang)||k.set(_.tgtLang,[]),k.get(_.tgtLang).push(_objectSpread(_objectSpread({},_),{},{src:E}));case 10:b++,e.n=6;break;case 11:A=0,S=_createForOfIteratorHelper(k.values());try{for(S.s();!(I=S.n()).done;)O=I.value,A+=O.length}catch(e){S.e(e)}finally{S.f()}if(0!==A){e.n=12;break}return log("Brak danych do t≈Çumaczenia."),e.a(2);case 12:T=0,L=_createForOfIteratorHelper(k.entries()),e.p=13,L.s();case 14:if((G=L.n()).done){e.n=21;break}if(C=_slicedToArray(G.value,2),B=C[0],P=C[1],B){e.n=15;break}return e.a(3,20);case 15:log("".concat(r," ‚Üí ").concat(B,": ").concat(P.length," rekord√≥w")),j=0;case 16:if(!(j<P.length)){e.n=20;break}return x=P.slice(j,j+BATCH_SIZE),R=x.map(function(e){return e.src}),D=applyGlossaryTokens(R,B,u),N=D.tokenizedLines,K=D.tokenMap,log("  batch ".concat(Math.floor(j/BATCH_SIZE)+1,": wysy≈Çam ").concat(R.length," linii")),e.n=17,callOpenAI(B,N,r);case 17:for(H=e.v,U=0;U<x.length;U++)M=restoreGlossaryTokens(H[U]||"",K),a.getCell(x[U].absRow,x[U].absCol).values=[[M]];return e.n=18,t.sync();case 18:T+=x.length,setProgress(Math.round(T/A*100));case 19:j+=BATCH_SIZE,e.n=16;break;case 20:e.n=14;break;case 21:e.n=23;break;case 22:e.p=22,F=e.v,L.e(F);case 23:return e.p=23,L.f(),e.f(23);case 24:setProgress(null),log("Gotowe.");case 25:return e.a(2)}},e,null,[[13,22,23,24]])}));return function(n){return e.apply(this,arguments)}}())}},e)})),_runTranslate.apply(this,arguments)}function callOpenAI(e,n){return _callOpenAI.apply(this,arguments)}function _callOpenAI(){return _callOpenAI=_asyncToGenerator(_regenerator().m(function e(n,r){var t,a,o,c,s,i,l,u,f,g,y,p,d,m,h=arguments;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(o="You are translating product names from ".concat("PL"===(a=h.length>2&&void 0!==h[2]?h[2]:"EN")?"Polish":"English",". Keep meaning 1:1. Preserve brands, model codes, numbers, units, punctuation, and casing. Do not add marketing words. Do not paraphrase. Return one translation per line in the same order. Output only translations. Do NOT translate or alter tokens like [[G1]], [[G2]]; keep them exactly."),c="Translate from ".concat(a," to ").concat(n,"\nTexts (one per line):\n")+r.join("\n"),s={model:MODEL,messages:[{role:"system",content:o},{role:"user",content:c}],max_tokens:2e3,temperature:.3},i=getApiKey()){e.n=1;break}throw new Error("Brak klucza API! Dodaj klucz w sekcji Konfiguracja.");case 1:l=null,u=1;case 2:if(!(u<=MAX_RETRIES)){e.n=10;break}return e.p=3,log("  Pr√≥ba ".concat(u,"/").concat(MAX_RETRIES,"...")),e.n=4,fetch(OPENAI_API_URL,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(i),"OpenAI-Organization":""},body:JSON.stringify(s)});case 4:if((g=e.v).ok){e.n=6;break}return e.n=5,g.text();case 5:throw y=e.v,new Error("OpenAI API error: ".concat(g.status," - ").concat(y));case 6:return e.n=7,g.json();case 7:return p=e.v,d=(null===(f=p.choices)||void 0===f||null===(f=f[0])||void 0===f||null===(f=f.message)||void 0===f?void 0:f.content)||"",e.a(2,d.split(/\r?\n/));case 8:if(e.p=8,m=e.v,l=m,log("  ‚ö†Ô∏è B≈ÇƒÖd: ".concat(m.message)),!(u<MAX_RETRIES)){e.n=9;break}return log("  Czekam ".concat(RETRY_DELAY/1e3,"s przed kolejnƒÖ pr√≥bƒÖ...")),e.n=9,new Promise(function(e){return setTimeout(e,RETRY_DELAY)});case 9:u++,e.n=2;break;case 10:throw new Error("Nie uda≈Ço siƒô po≈ÇƒÖczyƒá z OpenAI po ".concat(MAX_RETRIES," pr√≥bach. Sprawd≈∫:\n1. Czy klucz API jest prawid≈Çowy\n2. Czy masz ≈õrodki na koncie OpenAI\n3. Spr√≥buj ponownie za chwilƒô\n\nOstatni b≈ÇƒÖd: ").concat(null===(t=l)||void 0===t?void 0:t.message));case 11:return e.a(2)}},e,null,[[3,8]])})),_callOpenAI.apply(this,arguments)}function refreshGlossaryAll(){return _refreshGlossaryAll.apply(this,arguments)}function _refreshGlossaryAll(){return(_refreshGlossaryAll=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,loadGlossaryFromAllSheets();case 1:fillLangDropdown(),renderGlossaryList();case 2:return e.a(2)}},e)}))).apply(this,arguments)}function showGlossarySheets(){return _showGlossarySheets.apply(this,arguments)}function _showGlossarySheets(){return _showGlossarySheets=_asyncToGenerator(_regenerator().m(function e(){var n;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return log("Otwieranie arkuszy glosariuszy..."),e.p=1,e.n=2,Excel.run(function(){var e=_asyncToGenerator(_regenerator().m(function e(n){var r,t,a;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return(r=n.workbook.worksheets).load("items/name"),e.n=1,n.sync();case 1:if(0!==(t=r.items.filter(function(e){var n=e.name.toUpperCase();return(n.startsWith("EN-")||n.startsWith("PL-"))&&n.length>=5})).length){e.n=2;break}return log("‚ö†Ô∏è Nie znaleziono arkuszy glosariuszy (EN-PL, PL-EN, EN-DE, itp.)"),log("Stw√≥rz je najpierw u≈ºywajƒÖc 'Dodaj/zaktualizuj parƒô' lub 'Za≈Çaduj podstawowy glosariusz'"),e.a(2);case 2:return t[0].activate(),e.n=3,n.sync();case 3:a=t.map(function(e){return e.name}).join(", "),log("‚úÖ Znaleziono arkusze: ".concat(a)),log("üìã Aktywowano: ".concat(t[0].name)),log("üí° Mo≈ºesz prze≈ÇƒÖczaƒá siƒô miƒôdzy arkuszami u≈ºywajƒÖc zak≈Çadek na dole Excela");case 4:return e.a(2)}},e)}));return function(n){return e.apply(this,arguments)}}());case 2:e.n=4;break;case 3:e.p=3,n=e.v,log("‚ùå B≈ÇƒÖd: ".concat(n.message)),console.error(n);case 4:return e.a(2)}},e,null,[[1,3]])})),_showGlossarySheets.apply(this,arguments)}function loadBasicGlossary(){return _loadBasicGlossary.apply(this,arguments)}function _loadBasicGlossary(){return _loadBasicGlossary=_asyncToGenerator(_regenerator().m(function e(){var n,r,t,a,o;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.n=1,customConfirm("Czy za≈Çadowaƒá podstawowy glosariusz?\n\nTo doda terminy techniczne do arkuszy:\n‚Ä¢ EN ‚Üí PL, DE, FR, ES, IT, RO, UA, RU\n‚Ä¢ PL ‚Üí EN (t≈Çumaczenie polsko-angielskie)");case 1:if(e.v){e.n=2;break}return e.a(2);case 2:return log("≈Åadowanie podstawowego glosariusza..."),e.p=3,n=(new Date).getTime(),e.n=4,fetch("https://gperyk.github.io/translator-addin-host/glossary/basic-glossary.json?t=".concat(n));case 4:if((r=e.v).ok){e.n=5;break}throw new Error("HTTP error! status: ".concat(r.status));case 5:return e.n=6,r.json();case 6:if((t=e.v)&&t.terms){e.n=7;break}throw new Error("Nieprawid≈Çowa struktura danych glosariusza. Spr√≥buj ponownie za chwilƒô.");case 7:return a=0,e.n=8,Excel.run(function(){var e=_asyncToGenerator(_regenerator().m(function e(n){var r,o,c,s,i,l,u,f,g,y,p,d,m,h,v,k,b,w,_,E;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return(r=n.workbook.worksheets).load("items/name"),e.n=1,n.sync();case 1:o=t.terms,c=["pl","de","fr","es","it","ro","ua","ru"],s=_regenerator().m(function e(){var t,c,s,u,f,g,y,p,d,m,h,v,k,b,w,_,E,z,A,S;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=l[i],c=t.toUpperCase(),s="EN-".concat(c),u=r.items.find(function(e){return e.name.toUpperCase()===s}),f=!1,u){e.n=2;break}return(u=r.add(s)).getRange("A1:B1").values=[["EN",c]],e.n=1,n.sync();case 1:f=!0;case 2:if(g=[],y=new Set,e.p=3,!(p=u.getUsedRange())){e.n=5;break}return p.load("values,rowCount"),e.n=4,n.sync();case 4:if((g=p.values||[]).length>1)for(d=1;d<g.length;d++)(m=(g[d][0]||"").toString().trim().toLowerCase())&&y.add(m);case 5:e.n=7;break;case 6:e.p=6,e.v,console.log("Sheet ".concat(s," is new or empty"));case 7:h=[],v=_createForOfIteratorHelper(o);try{for(v.s();!(k=v.n()).done;)(b=k.value)[t]&&""!==b[t].trim()&&(w=(b.en||"").toString().trim().toLowerCase())&&!y.has(w)&&(h.push([b.en,b[t]]),a++)}catch(e){v.e(e)}finally{v.f()}if(!(h.length>0)){e.n=9;break}return _=g.length>1?g.length+1:2,u.getRangeByIndexes(_-1,0,h.length,2).values=h,e.n=8,n.sync();case 8:log("‚úÖ Dodano ".concat(h.length," termin√≥w do ").concat(s)),e.n=10;break;case 9:if(f){log("üìã Utworzono arkusz ".concat(s," - sprawdzanie termin√≥w...")),E=0,z=_createForOfIteratorHelper(o);try{for(z.s();!(A=z.n()).done;)(S=A.value)[t]&&""!==S[t].trim()&&E++}catch(e){z.e(e)}finally{z.f()}log(E>0?"‚ö†Ô∏è Znaleziono ".concat(E," termin√≥w z t≈Çumaczeniem ").concat(t.toUpperCase(),", ale wszystkie ju≈º istniejƒÖ w arkuszu."):"‚ÑπÔ∏è Brak termin√≥w z t≈Çumaczeniem ".concat(t.toUpperCase()," w glosariuszu."))}case 10:return e.a(2)}},e,null,[[3,6]])}),i=0,l=c;case 2:if(!(i<l.length)){e.n=4;break}return e.d(_regeneratorValues(s()),3);case 3:i++,e.n=2;break;case 4:if(!(t.pl_en_terms&&t.pl_en_terms.length>0)){e.n=14;break}if(u="PL-EN",f=r.items.find(function(e){return e.name.toUpperCase()===u}),g=!1,f){e.n=6;break}return(f=r.add(u)).getRange("A1:B1").values=[["PL","EN"]],e.n=5,n.sync();case 5:g=!0;case 6:if(y=[],p=new Set,e.p=7,!(d=f.getUsedRange())){e.n=9;break}return d.load("values,rowCount"),e.n=8,n.sync();case 8:if((y=d.values||[]).length>1)for(m=1;m<y.length;m++)(h=(y[m][0]||"").toString().trim().toLowerCase())&&p.add(h);case 9:e.n=11;break;case 10:e.p=10,e.v,console.log("Sheet ".concat(u," is new or empty"));case 11:v=[],k=_createForOfIteratorHelper(t.pl_en_terms);try{for(k.s();!(b=k.n()).done;)(w=b.value).pl&&w.en&&(_=w.pl.toString().trim().toLowerCase())&&!p.has(_)&&(v.push([w.pl,w.en]),a++)}catch(e){k.e(e)}finally{k.f()}if(!(v.length>0)){e.n=13;break}return E=y.length>1?y.length+1:2,f.getRangeByIndexes(E-1,0,v.length,2).values=v,e.n=12,n.sync();case 12:log("‚úÖ Dodano ".concat(v.length," termin√≥w do PL-EN")),e.n=14;break;case 13:g&&log("üìã Utworzono arkusz PL-EN");case 14:return e.a(2)}},e,null,[[7,10]])}));return function(n){return e.apply(this,arguments)}}());case 8:return e.n=9,refreshGlossaryAll();case 9:if(log("‚úÖ Dodano ".concat(a," nowych termin√≥w do glosariuszy!")),!(a>0)){e.n=10;break}return log("Otwieranie arkuszy glosariuszy..."),e.n=10,showGlossarySheets();case 10:e.n=12;break;case 11:e.p=11,o=e.v,log("‚ùå B≈ÇƒÖd: ".concat(o.message)),console.error(o);case 12:return e.a(2)}},e,null,[[3,11]])})),_loadBasicGlossary.apply(this,arguments)}function loadGlossaryFromAllSheets(){return _loadGlossaryFromAllSheets.apply(this,arguments)}function _loadGlossaryFromAllSheets(){return _loadGlossaryFromAllSheets=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Excel.run(function(){var e=_asyncToGenerator(_regenerator().m(function e(n){var r,t,a,o,c,s,i,l,u,f,g,y,p,d,m,h,v,k,b,w,_,E,z,A,S,I,O,T,L,G,C,B;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return(r=n.workbook.worksheets).load("items/name"),e.n=1,n.sync();case 1:t={},a=new Set,o={},c={},s=new Set,i={},l=_createForOfIteratorHelper(r.items),e.p=2,l.s();case 3:if((u=l.n()).done){e.n=20;break}if(f=u.value,!((g=f.name.toUpperCase()).startsWith("EN-")&&g.length>=5)){e.n=11;break}if(y=g.slice(3).trim(),p=normalizeHeader(y)){e.n=4;break}return e.a(3,19);case 4:return a.add(p),o[p]=f.name,(d=f.getUsedRange()).load("values,rowCount,columnCount"),e.n=5,n.sync();case 5:if(!((m=d.values||[]).length<2)){e.n=6;break}return e.a(3,19);case 6:if(h=m[0].map(function(e){return normalizeHeader(e)}),v=h.indexOf("EN"),k=h.indexOf(p),!(v<0||k<0)){e.n=7;break}return e.a(3,19);case 7:b=1;case 8:if(!(b<m.length)){e.n=11;break}if(w=(m[b][v]||"").toString().trim(),_=(m[b][k]||"").toString().trim(),w&&_){e.n=9;break}return e.a(3,10);case 9:t[w]||(t[w]={}),t[w][p]=_;case 10:b++,e.n=8;break;case 11:if(!(g.startsWith("PL-")&&g.length>=5)){e.n=19;break}if(E=g.slice(3).trim(),z=normalizeHeader(E)){e.n=12;break}return e.a(3,19);case 12:return s.add(z),i[z]=f.name,(A=f.getUsedRange()).load("values,rowCount,columnCount"),e.n=13,n.sync();case 13:if(!((S=A.values||[]).length<2)){e.n=14;break}return e.a(3,19);case 14:if(I=S[0].map(function(e){return normalizeHeader(e)}),O=I.indexOf("PL"),T=I.indexOf(z),!(O<0||T<0)){e.n=15;break}return e.a(3,19);case 15:L=1;case 16:if(!(L<S.length)){e.n=19;break}if(G=(S[L][O]||"").toString().trim(),C=(S[L][T]||"").toString().trim(),G&&C){e.n=17;break}return e.a(3,18);case 17:c[G]||(c[G]={}),c[G][z]=C;case 18:L++,e.n=16;break;case 19:e.n=3;break;case 20:e.n=22;break;case 21:e.p=21,B=e.v,l.e(B);case 22:return e.p=22,l.f(),e.f(22);case 23:glossaryCache=t,availableLangs=Array.from(a).sort(),langToSheetMap=o,plGlossaryCache=c,plAvailableLangs=Array.from(s).sort(),plLangToSheetMap=i;case 24:return e.a(2)}},e,null,[[2,21,22,23]])}));return function(n){return e.apply(this,arguments)}}());case 1:return e.a(2,glossaryCache)}},e)})),_loadGlossaryFromAllSheets.apply(this,arguments)}function addOrUpdateGlossaryPair(){return _addOrUpdateGlossaryPair.apply(this,arguments)}function _addOrUpdateGlossaryPair(){return _addOrUpdateGlossaryPair=_asyncToGenerator(_regenerator().m(function e(){var n,r,t,a,o,c,s;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(n=normalizeHeader(document.getElementById("gLangSelect").value),r=document.getElementById("gNewLang").value.trim(),t=normalizeHeader(r),a=document.getElementById("sourceLangSelect").value||"EN",o=document.getElementById("gEn").value.trim(),c=document.getElementById("gTr").value.trim(),s=t||n){e.n=1;break}return log("Wybierz jƒôzyk z listy albo wpisz nowy (np. PL lub EN)."),e.a(2);case 1:if(o&&c){e.n=2;break}return log("Uzupe≈Çnij frazƒô ".concat(a," i t≈Çumaczenie.")),e.a(2);case 2:return e.n=3,Excel.run(function(){var e=_asyncToGenerator(_regenerator().m(function e(n){var r,t,i,l,u,f,g,y,p,d,m,h,v,k,b;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return(r=n.workbook.worksheets).load("items/name"),e.n=1,n.sync();case 1:if(t="".concat(a,"-").concat(s),!(l=r.items.find(function(e){return e.name.toUpperCase()===t}))){e.n=2;break}i=l,e.n=3;break;case 2:return(i=r.add(t)).getRange("A1:B1").values=[[a,s]],e.n=3,n.sync();case 3:return(u=i.getUsedRange()).load("values,rowCount"),e.n=4,n.sync();case 4:if(f=u.values||[],g=f[0].map(function(e){return normalizeHeader(e)}),y=g.indexOf(a),p=g.indexOf(s),!(y<0||p<0)){e.n=5;break}return log("B≈ÅƒÑD: Arkusz ".concat(t," musi mieƒá nag≈Ç√≥wki ").concat(a," oraz ").concat(s," w wierszu 1.")),e.a(2);case 5:d=-1,m=1;case 6:if(!(m<f.length)){e.n=8;break}if((f[m][y]||"").toString().trim().toLowerCase()!==o.toLowerCase()){e.n=7;break}return d=m+1,e.a(3,8);case 7:m++,e.n=6;break;case 8:return d>0?(h=indexToCol(p+1),i.getRange("".concat(h).concat(d)).values=[[c]]):(v=f.length+1,k=indexToCol(y+1),b=indexToCol(p+1),i.getRange("".concat(k).concat(v)).values=[[o]],i.getRange("".concat(b).concat(v)).values=[[c]]),e.n=9,n.sync();case 9:return e.a(2)}},e)}));return function(n){return e.apply(this,arguments)}}());case 3:return e.n=4,refreshGlossaryAll();case 4:document.getElementById("gEn").value="",document.getElementById("gTr").value="",document.getElementById("gNewLang").value="",log("Zapisano glosariusz: ".concat(termEN," -> ").concat(s,":").concat(c));case 5:return e.a(2)}},e)})),_addOrUpdateGlossaryPair.apply(this,arguments)}function renderGlossaryList(){var e=document.getElementById("gList");if(e){for(var n="PL"===(document.getElementById("sourceLangSelect").value||"EN")?plGlossaryCache||{}:glossaryCache||{},r=normalizeHeader(document.getElementById("gLangSelect").value),t=[],a=0,o=Object.keys(n);a<o.length;a++){var c=o[a],s=n[c]||{};if(r)s[r]&&t.push("".concat(c,"  ‚Üí  ").concat(s[r]));else for(var i=0,l=Object.keys(s);i<l.length;i++){var u=l[i];t.push("".concat(c,"  |  ").concat(u,"  ‚Üí  ").concat(s[u]))}}e.textContent=t.length?t.join("\n"):"(brak wpis√≥w dla tego jƒôzyka)"}}function applyGlossaryTokens(e,n,r){var t={},a=Object.keys(r||{}).sort(function(e,n){return n.length-e.length});return{tokenizedLines:e.map(function(e){var o,c=e,s=_createForOfIteratorHelper(a);try{for(s.s();!(o=s.n()).done;){var i,l=o.value,u=null===(i=r[l])||void 0===i?void 0:i[n];if(u){var f="[[G".concat(Object.keys(t).length+1,"]]"),g=escapeRegex(l),y=new RegExp("\\b".concat(g,"\\b"),"gi");c=c.replace(y,f),t[f]=u}}}catch(e){s.e(e)}finally{s.f()}return c}),tokenMap:t}}function restoreGlossaryTokens(e,n){for(var r=e,t=0,a=Object.keys(n);t<a.length;t++){var o=a[t];r=r.split(o).join(n[o])}return r}function normalizeHeader(e){return(null!=e?e:"").toString().replace(/\u00A0/g," ").trim().toUpperCase()}function escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function indexToCol(e){for(var n="";e>0;){var r=(e-1)%26;n=String.fromCharCode(65+r)+n,e=Math.floor((e-1)/26)}return n}Office.onReady(function(){var e=_asyncToGenerator(_regenerator().m(function e(n){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(n.host===Office.HostType.Excel){e.n=1;break}return e.a(2);case 1:return document.getElementById("runBtn").onclick=runTranslate,document.getElementById("gReloadBtn").onclick=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,refreshGlossaryAll();case 1:log("Glosariusz od≈õwie≈ºony.");case 2:return e.a(2)}},e)})),document.getElementById("gAddBtn").onclick=addOrUpdateGlossaryPair,document.getElementById("gLangSelect").onchange=function(){renderGlossaryList()},document.getElementById("sourceLangSelect").onchange=function(){fillLangDropdown(),renderGlossaryList(),updateGlossaryPlaceholders()},document.getElementById("gLoadBasicBtn").onclick=loadBasicGlossary,document.getElementById("gShowSheetsBtn").onclick=showGlossarySheets,document.getElementById("saveApiKeyBtn").onclick=saveApiKey,document.getElementById("clearApiKeyBtn").onclick=clearApiKey,updateApiKeyStatus(),e.n=2,refreshGlossaryAll();case 2:return e.a(2)}},e)}));return function(n){return e.apply(this,arguments)}}());